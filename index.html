<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pet Claim IQ ‚Äî Know Before You File</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&family=Fraunces:ital,opsz,wght@0,9..144,400;0,9..144,600;0,9..144,700;1,9..144,400&display=swap" rel="stylesheet">
<style>
  :root {
    --green: #16a34a;
    --green-light: #22c55e;
    --green-dark: #15803d;
    --green-bg: #f0fdf4;
    --green-border: #bbf7d0;
    --orange: #f97316;
    --red: #ef4444;
    --red-bg: #fef2f2;
    --red-border: #fecaca;
    --yellow: #eab308;
    --yellow-bg: #fefce8;
    --yellow-border: #fef08a;
    --blue: #2563eb;
    --blue-bg: #eff6ff;
    --blue-border: #bfdbfe;
    --g50: #f9fafb; --g100: #f3f4f6; --g200: #e5e7eb; --g300: #d1d5db;
    --g400: #9ca3af; --g500: #6b7280; --g600: #4b5563; --g700: #374151;
    --g800: #1f2937; --g900: #111827;
    --shadow: 0 4px 6px -1px rgba(0,0,0,0.07), 0 2px 4px -2px rgba(0,0,0,0.05);
    --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.08), 0 4px 6px -4px rgba(0,0,0,0.04);
    --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.08), 0 8px 10px -6px rgba(0,0,0,0.04);
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'DM Sans', -apple-system, sans-serif;
    background: linear-gradient(180deg, #f0fdf4 0%, #fff 30%, #f9fafb 100%);
    color: var(--g800);
    -webkit-font-smoothing: antialiased;
    min-height: 100vh;
  }

  .container { max-width: 680px; margin: 0 auto; padding: 0 20px; }

  /* === HEADER === */
  .header { text-align: center; padding: 40px 20px 10px; }
  .logo-row {
    display: inline-flex; align-items: center; gap: 8px;
    background: linear-gradient(135deg, var(--green), var(--green-dark));
    color: white; font-size: 12px; font-weight: 600;
    letter-spacing: 0.04em; text-transform: uppercase;
    padding: 6px 14px; border-radius: 100px; margin-bottom: 20px;
  }
  .header h1 {
    font-family: 'Fraunces', serif; font-size: 30px; font-weight: 700;
    color: var(--g900); line-height: 1.25; margin-bottom: 12px;
  }
  .header p { font-size: 16px; color: var(--g600); line-height: 1.5; max-width: 520px; margin: 0 auto; }

  /* === TRUST BAR === */
  .trust-bar {
    display: flex; justify-content: center; flex-wrap: wrap; gap: 6px 16px;
    margin: 16px auto 0; max-width: 560px;
  }
  .trust-item {
    display: flex; align-items: center; gap: 6px;
    font-size: 13px; font-weight: 500; color: var(--g600);
  }
  .trust-item .ti-icon {
    width: 20px; height: 20px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 10px; flex-shrink: 0;
  }
  .trust-item .ti-icon.green { background: var(--green-bg); color: var(--green); border: 1px solid var(--green-border); }
  .trust-item .ti-icon.blue { background: var(--blue-bg); color: var(--blue); border: 1px solid var(--blue-border); }

  /* === STEPS === */
  .steps { display: flex; justify-content: center; gap: 6px; margin: 28px auto 32px; max-width: 400px; }
  .step { display: flex; align-items: center; gap: 6px; font-size: 13px; color: var(--g500); font-weight: 500; }
  .step-num {
    width: 24px; height: 24px; border-radius: 50%; background: var(--g200);
    color: var(--g500); display: flex; align-items: center; justify-content: center;
    font-size: 12px; font-weight: 700;
  }
  .step.active .step-num { background: var(--green); color: white; }
  .step.active { color: var(--g700); }
  .step-arrow { color: var(--g300); font-size: 14px; }

  /* === UPLOAD SECTION === */
  .upload-section {
    background: white; border-radius: 20px; box-shadow: var(--shadow-xl);
    border: 1px solid rgba(0,0,0,0.06); overflow: hidden; margin-bottom: 20px;
  }
  .upload-section::before {
    content: ''; display: block; height: 4px;
    background: linear-gradient(90deg, var(--green), var(--green-light), var(--orange));
  }
  .upload-inner { padding: 24px; }
  .upload-group { margin-bottom: 20px; }
  .upload-group:last-of-type { margin-bottom: 0; }
  .upload-label {
    display: flex; align-items: center; gap: 8px;
    font-size: 14px; font-weight: 600; color: var(--g800); margin-bottom: 8px;
  }
  .upload-label .req {
    font-size: 11px; font-weight: 600; color: var(--red);
    background: var(--red-bg); border: 1px solid var(--red-border);
    padding: 1px 6px; border-radius: 4px;
  }
  .upload-label .opt { font-size: 11px; font-weight: 500; color: var(--g500); }
  .upload-hint { font-size: 13px; color: var(--g600); margin-bottom: 8px; line-height: 1.5; }

  .drop-zone {
    border: 2px dashed var(--g300); border-radius: 14px; padding: 28px 20px;
    text-align: center; cursor: pointer; transition: all 0.25s ease;
    background: var(--g50); position: relative;
  }
  .drop-zone:hover, .drop-zone.dragover { border-color: var(--green); background: var(--green-bg); transform: scale(1.01); }
  .drop-zone.has-file { border-color: var(--green); border-style: solid; background: var(--green-bg); }
  .drop-zone input[type="file"] { position: absolute; inset: 0; opacity: 0; cursor: pointer; }
  .drop-icon { font-size: 28px; margin-bottom: 4px; }
  .drop-text { font-size: 14px; color: var(--g600); }
  .drop-text strong { color: var(--green); }
  .file-name {
    font-size: 13px; font-weight: 600; color: var(--green-dark);
    display: flex; align-items: center; justify-content: center; gap: 6px;
  }
  .file-remove {
    background: none; border: none; color: var(--g400);
    cursor: pointer; font-size: 16px; padding: 0 4px; line-height: 1;
  }
  .file-remove:hover { color: var(--red); }

  /* Multi-file chips */
  .file-chips { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; justify-content: center; }
  .file-chip {
    display: inline-flex; align-items: center; gap: 6px;
    background: var(--green-bg); border: 1px solid var(--green-border);
    border-radius: 8px; padding: 6px 10px; font-size: 12px;
    font-weight: 600; color: var(--green-dark);
  }
  .file-chip button {
    background: none; border: none; color: var(--g400);
    cursor: pointer; font-size: 14px; padding: 0; line-height: 1;
  }
  .file-chip button:hover { color: var(--red); }
  .add-more-btn {
    display: inline-flex; align-items: center; gap: 4px;
    background: none; border: 2px dashed var(--g300); border-radius: 8px;
    padding: 6px 12px; font-size: 12px; font-weight: 600;
    color: var(--g400); cursor: pointer; transition: all 0.2s;
    font-family: 'DM Sans', sans-serif;
  }
  .add-more-btn:hover { border-color: var(--green); color: var(--green); }

  .helper-box {
    background: var(--blue-bg); border: 1px solid var(--blue-border);
    border-radius: 10px; padding: 14px 16px; margin: 20px 0;
    display: flex; align-items: flex-start; gap: 10px;
  }
  .helper-box .hb-icon { font-size: 16px; flex-shrink: 0; margin-top: 1px; }
  .helper-box p { font-size: 13px; color: var(--g700); line-height: 1.5; }

  .analyze-btn {
    display: block; width: 100%; padding: 18px;
    background: linear-gradient(135deg, var(--green), var(--green-dark));
    color: white; border: none; border-radius: 14px;
    font-family: 'DM Sans', sans-serif; font-size: 17px; font-weight: 700;
    cursor: pointer; transition: all 0.25s ease; letter-spacing: 0.01em; margin-top: 24px;
    box-shadow: 0 4px 14px rgba(22, 163, 74, 0.25);
  }
  .analyze-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(22, 163, 74, 0.4); }
  .analyze-btn:active:not(:disabled) { transform: translateY(0); }
  .analyze-btn:disabled { opacity: 0.6; cursor: not-allowed; box-shadow: none; }

  /* Loading */
  .loading-overlay { display: none; text-align: center; padding: 60px 20px; }
  .loading-overlay.visible { display: block; }
  .spinner {
    width: 48px; height: 48px; border: 4px solid var(--g200);
    border-top-color: var(--green); border-radius: 50%;
    animation: spin 0.8s linear infinite; margin: 0 auto 20px;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  .loading-overlay h3 { font-family: 'Fraunces', serif; font-size: 20px; color: var(--g800); margin-bottom: 8px; }
  .loading-overlay p { font-size: 14px; color: var(--g400); }

  /* Error */
  .error-box { display: none; background: var(--red-bg); border: 1px solid var(--red-border); border-radius: 12px; padding: 20px; text-align: center; margin: 20px auto; max-width: 680px; }
  .error-box.visible { display: block; }
  .error-box p { font-size: 14px; color: var(--g700); line-height: 1.5; }
  .error-box .err-icon { font-size: 28px; margin-bottom: 8px; }
  .error-box button {
    margin-top: 12px; padding: 10px 20px; background: white;
    border: 1px solid var(--g300); border-radius: 8px;
    font-family: 'DM Sans', sans-serif; font-size: 14px; font-weight: 600; cursor: pointer; color: var(--g700);
  }

  /* === RESULTS === */
  .results-section { display: none; margin-bottom: 40px; animation: fadeUp 0.5s ease-out; }
  .results-section.visible { display: block; }
  @keyframes fadeUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }

  .result-card {
    background: white; border-radius: 20px; box-shadow: var(--shadow-xl);
    border: 1px solid rgba(0,0,0,0.06); overflow: hidden; margin-bottom: 16px; position: relative;
  }
  .result-card::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 5px;
    background: linear-gradient(90deg, var(--green), var(--green-light), var(--orange));
  }

  .result-header { padding: 24px 24px 20px; border-bottom: 1px solid var(--g100); }
  .result-top-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 14px; flex-wrap: wrap; gap: 10px; }
  .result-pet h3 { font-family: 'Fraunces', serif; font-size: 20px; font-weight: 700; color: var(--g900); }
  .result-pet .pet-sub { font-size: 13px; color: var(--g600); margin-top: 2px; }
  .result-insurer {
    display: flex; align-items: center; gap: 8px;
    background: var(--g50); padding: 8px 14px; border-radius: 10px;
    border: 1px solid var(--g200); font-size: 13px; font-weight: 600; color: var(--g700);
  }
  .result-meta { display: flex; gap: 16px; flex-wrap: wrap; font-size: 13px; color: var(--g600); }
  .result-meta strong { color: var(--g700); }

  .line-items { padding: 20px 24px; border-bottom: 1px solid var(--g100); }
  .section-title { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.06em; color: var(--g500); margin-bottom: 12px; }
  .line-item { display: flex; align-items: flex-start; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--g100); }
  .line-item:last-child { border-bottom: none; }
  .li-left { display: flex; align-items: flex-start; gap: 10px; flex: 1; }
  .li-status { width: 22px; height: 22px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; flex-shrink: 0; margin-top: 1px; }
  .li-status.covered { background: var(--green-bg); color: var(--green); border: 1.5px solid var(--green-border); }
  .li-status.excluded { background: var(--red-bg); color: var(--red); border: 1.5px solid var(--red-border); }
  .li-status.uncertain { background: var(--yellow-bg); color: var(--yellow); border: 1.5px solid var(--yellow-border); }
  .li-status.unknown { background: var(--g100); color: var(--g400); border: 1.5px solid var(--g300); }
  .li-name { font-size: 14px; font-weight: 500; color: var(--g800); line-height: 1.3; }
  .li-reason { font-size: 12px; color: var(--g400); margin-top: 2px; }
  .li-reason.exc { color: var(--red); font-weight: 500; }
  .li-reason.unc { color: var(--yellow); font-weight: 500; }
  .li-amount { font-size: 14px; font-weight: 600; color: var(--g700); white-space: nowrap; padding-left: 12px; }
  .li-amount.struck { color: var(--g400); text-decoration: line-through; }

  .warnings-box { margin: 0 24px; padding: 14px 16px; background: var(--red-bg); border: 1px solid var(--red-border); border-radius: 10px; }
  .warnings-box p { font-size: 13px; color: var(--g700); line-height: 1.5; margin-bottom: 6px; }
  .warnings-box p:last-child { margin-bottom: 0; }
  .warnings-box strong { color: var(--red); }

  .math-section { padding: 20px 24px; border-bottom: 1px solid var(--g100); }
  .math-box { background: var(--g50); border-radius: 10px; padding: 16px; border: 1px solid var(--g200); }
  .math-row { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; font-size: 14px; }
  .math-label { color: var(--g700); }
  .math-val { font-weight: 600; color: var(--g800); font-variant-numeric: tabular-nums; }
  .math-divider { border-top: 1px dashed var(--g300); margin-top: 6px; padding-top: 10px; }
  .math-result { border-top: 2px solid var(--g300); margin-top: 8px; padding-top: 12px; }
  .math-result .math-label { font-weight: 600; color: var(--g800); }
  .math-result .math-val { font-size: 16px; color: var(--green); }
  .math-note { font-size: 12px; color: var(--g500); font-style: italic; margin-top: 10px; line-height: 1.4; }

  /* Deductible calculator */
  .deductible-section { padding: 20px 24px; border-bottom: 1px solid var(--g100); }
  .ded-input-row { display: flex; align-items: center; gap: 12px; margin: 12px 0; flex-wrap: wrap; }
  .ded-input-row label { font-size: 14px; color: var(--g600); flex-shrink: 0; }
  .ded-input {
    width: 140px; padding: 10px 12px; border: 2px solid var(--g300);
    border-radius: 8px; font-family: 'DM Sans', sans-serif; font-size: 15px;
    font-weight: 600; color: var(--g800); transition: border-color 0.2s;
  }
  .ded-input:focus { outline: none; border-color: var(--green); }
  .ded-input::placeholder { color: var(--g300); font-weight: 400; }
  .ded-annual { font-size: 13px; color: var(--g500); }

  .ded-results { display: none; margin-top: 16px; background: var(--green-bg); border: 1.5px solid var(--green-border); border-radius: 10px; padding: 16px; animation: fadeUp 0.3s ease-out; }
  .ded-results.visible { display: block; }
  .ded-results .section-title { color: var(--green-dark); margin-bottom: 10px; }

  .ded-progress-bar { width: 100%; height: 12px; background: var(--g200); border-radius: 6px; overflow: hidden; margin: 12px 0 6px; }
  .ded-progress-fill { height: 100%; background: linear-gradient(90deg, var(--green), var(--green-light)); border-radius: 6px; transition: width 0.4s ease; }
  .ded-progress-label { display: flex; justify-content: space-between; font-size: 12px; color: var(--g500); }

  /* Missing docs */
  .missing-box {
    background: var(--yellow-bg); border: 1.5px solid var(--yellow-border);
    border-radius: 12px; padding: 20px; margin: 20px 24px;
  }
  .missing-box h4 { font-family: 'Fraunces', serif; font-size: 16px; color: var(--g800); margin-bottom: 10px; }
  .missing-box ul { margin: 0 0 12px 18px; }
  .missing-box li { font-size: 13px; color: var(--g600); line-height: 1.6; }
  .missing-box .hint { font-size: 13px; color: var(--g500); font-style: italic; margin-bottom: 14px; line-height: 1.5; }
  .missing-box button {
    padding: 10px 20px; background: white; border: 2px solid var(--yellow);
    border-radius: 8px; font-family: 'DM Sans', sans-serif;
    font-size: 14px; font-weight: 600; cursor: pointer; color: var(--g700); transition: all 0.2s;
  }
  .missing-box button:hover { background: var(--yellow-bg); border-color: var(--orange); }

  .bill-only-box {
    background: var(--blue-bg); border: 1.5px solid var(--blue-border);
    border-radius: 12px; padding: 20px; margin: 20px 24px; text-align: center;
  }
  .bill-only-box h4 { font-family: 'Fraunces', serif; font-size: 16px; color: var(--g800); margin-bottom: 10px; }
  .bill-only-box p { font-size: 13px; color: var(--g500); line-height: 1.6; margin-bottom: 14px; }
  .bill-only-box button {
    padding: 10px 20px; background: white; border: 2px solid var(--blue);
    border-radius: 8px; font-family: 'DM Sans', sans-serif;
    font-size: 14px; font-weight: 600; cursor: pointer; color: var(--g700); transition: all 0.2s;
  }
  .bill-only-box button:hover { background: var(--blue-bg); }

  .rec-section { padding: 24px; }
  .rec-box {
    background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
    border: 1.5px solid var(--green-border); border-radius: 12px; padding: 20px;
  }
  .rec-box.no-file {
    background: linear-gradient(135deg, var(--red-bg) 0%, #fff1f2 100%);
    border-color: var(--red-border);
  }
  .rec-header { display: flex; align-items: center; gap: 8px; margin-bottom: 10px; }
  .rec-header h4 { font-family: 'Fraunces', serif; font-size: 17px; font-weight: 700; color: var(--green-dark); }
  .rec-box.no-file .rec-header h4 { color: var(--red); }
  .rec-text { font-size: 14px; color: var(--g600); line-height: 1.6; }
  .rec-text strong { color: var(--g800); }

  .deadline-section { padding: 0 24px 20px; }
  .deadline-box {
    display: flex; align-items: center; justify-content: space-between;
    background: var(--green-bg); border: 1px solid var(--green-border);
    border-radius: 10px; padding: 14px 16px;
  }
  .deadline-left { display: flex; align-items: center; gap: 10px; }
  .deadline-text { font-size: 14px; color: var(--g700); }
  .deadline-text strong { color: var(--g900); }

  .start-over-btn {
    display: block; width: 100%; padding: 14px;
    background: white; color: var(--g600);
    border: 2px solid var(--g200); border-radius: 12px;
    font-family: 'DM Sans', sans-serif; font-size: 15px;
    font-weight: 600; cursor: pointer; transition: all 0.2s; margin-top: 8px;
  }
  .start-over-btn:hover { border-color: var(--green); color: var(--green); }

  .pch-promo {
    background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 50%, white 100%);
    border: 2px solid var(--green-border);
    border-radius: 20px; padding: 28px; text-align: center; margin: 20px 0;
    box-shadow: 0 4px 16px rgba(22, 163, 74, 0.08);
  }
  .pch-promo h4 { font-family: 'Fraunces', serif; font-size: 20px; color: var(--g900); margin-bottom: 10px; }
  .pch-promo p { font-size: 15px; color: var(--g600); margin-bottom: 20px; line-height: 1.6; }
  .pch-promo a {
    display: inline-block; padding: 14px 32px;
    background: linear-gradient(135deg, var(--green), var(--green-dark));
    color: white; text-decoration: none; border-radius: 12px;
    font-weight: 700; font-size: 15px; transition: all 0.25s ease;
    box-shadow: 0 4px 14px rgba(22,163,74,0.25);
  }
  .pch-promo a:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(22,163,74,0.35); }

  .privacy {
    text-align: center; padding: 30px 20px 40px; font-size: 12px;
    color: var(--g500); line-height: 1.5; max-width: 480px; margin: 0 auto;
  }
  .privacy strong { color: var(--g600); }

  /* === CONFIDENCE BADGE === */
  .confidence-badge {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 6px 12px; border-radius: 8px; font-size: 13px; font-weight: 600;
  }
  .confidence-badge.high { background: var(--green-bg); color: var(--green-dark); border: 1px solid var(--green-border); }
  .confidence-badge.medium { background: var(--yellow-bg); color: #92400e; border: 1px solid var(--yellow-border); }
  .confidence-badge.low { background: var(--red-bg); color: #991b1b; border: 1px solid var(--red-border); }
  .confidence-help { font-size: 12px; color: var(--g500); margin-top: 6px; }

  /* === INSURER DISCLAIMER ON RESULTS === */
  .results-disclaimer {
    display: flex; align-items: center; justify-content: center; gap: 6px;
    font-size: 12px; color: var(--g500); margin: 8px 0 4px; font-weight: 500;
  }

  /* === MOBILE ENHANCEMENTS === */
  @media (max-width: 640px) {
    body { font-size: 16px; }
    .container { padding: 0 16px; }

    /* Header */
    .header { padding: 32px 16px 8px; }
    .header h1 { font-size: 28px; line-height: 1.2; }
    .header p { font-size: 16px; line-height: 1.6; }
    .logo-row { font-size: 13px; padding: 8px 18px; margin-bottom: 16px; }
    .trust-bar { gap: 4px 14px; margin-top: 14px; }
    .trust-item { font-size: 13px; }
    .trust-item .ti-icon { width: 22px; height: 22px; font-size: 11px; }

    /* Steps */
    .steps { gap: 4px; margin: 20px auto 24px; }
    .step { font-size: 13px; }
    .step-num { width: 28px; height: 28px; font-size: 13px; }

    /* Upload */
    .upload-section { border-radius: 20px; }
    .upload-inner { padding: 20px; }
    .upload-label { font-size: 16px; gap: 10px; margin-bottom: 8px; }
    .upload-label .req { font-size: 12px; padding: 2px 8px; }
    .upload-label .opt { font-size: 12px; }
    .upload-hint { font-size: 14px; line-height: 1.5; margin-bottom: 12px; }
    .drop-zone { padding: 28px 20px; border-radius: 14px; }
    .drop-icon { font-size: 36px; margin-bottom: 8px; }
    .drop-text { font-size: 15px; }
    .file-name { font-size: 15px; }
    .helper-box { padding: 16px; margin: 24px 0; border-radius: 14px; }
    .helper-box .hb-icon { font-size: 20px; }
    .helper-box p { font-size: 14px; line-height: 1.6; }
    .analyze-btn { padding: 18px; font-size: 18px; border-radius: 14px; margin-top: 24px; }
    .file-chip { font-size: 13px; padding: 8px 12px; border-radius: 10px; }
    .add-more-btn { font-size: 13px; padding: 8px 14px; }

    /* Results */
    .result-card { border-radius: 20px; }
    .result-card::before { height: 5px; }
    .result-header { padding: 24px 20px 20px; }
    .result-top-row { flex-direction: column; gap: 12px; }
    .result-pet h3 { font-size: 22px; }
    .result-pet .pet-sub { font-size: 14px; }
    .result-insurer { font-size: 14px; padding: 10px 16px; }
    .result-meta { font-size: 14px; gap: 12px; }

    /* Line items */
    .line-items { padding: 20px; }
    .section-title { font-size: 12px; letter-spacing: 0.08em; margin-bottom: 14px; }
    .li-status { width: 26px; height: 26px; font-size: 14px; }
    .li-name { font-size: 15px; }
    .li-reason { font-size: 13px; margin-top: 3px; }
    .li-amount { font-size: 15px; }
    .line-item { padding: 12px 0; }

    /* Warnings */
    .warnings-box { margin: 0 20px; padding: 16px 18px; border-radius: 14px; }
    .warnings-box p { font-size: 14px; }

    /* Math */
    .math-section { padding: 20px; }
    .math-box { padding: 18px; border-radius: 14px; }
    .math-row { font-size: 15px; padding: 8px 0; }
    .math-result .math-val { font-size: 18px; }
    .math-note { font-size: 13px; margin-top: 12px; }

    /* Deductible */
    .deductible-section { padding: 20px; }
    .deductible-section > p { font-size: 14px !important; }
    .ded-input-row { flex-direction: column; align-items: flex-start; gap: 8px; margin: 14px 0; }
    .ded-input-row label { font-size: 15px; }
    .ded-input { width: 100%; padding: 14px 16px; font-size: 18px; border-radius: 12px; }
    .ded-annual { font-size: 14px; }
    .ded-results { padding: 18px; border-radius: 14px; }
    .ded-progress-bar { height: 14px; border-radius: 7px; margin: 14px 0 8px; }
    .ded-progress-fill { border-radius: 7px; }
    .ded-progress-label { font-size: 13px; }

    /* Missing / Bill only */
    .missing-box { margin: 20px; padding: 20px; border-radius: 16px; }
    .missing-box h4 { font-size: 18px; }
    .missing-box li { font-size: 14px; }
    .missing-box .hint { font-size: 14px; }
    .missing-box button { padding: 12px 24px; font-size: 15px; border-radius: 10px; }
    .bill-only-box { margin: 20px; padding: 20px; border-radius: 16px; }
    .bill-only-box h4 { font-size: 18px; }
    .bill-only-box p { font-size: 14px; }
    .bill-only-box button { padding: 12px 24px; font-size: 15px; border-radius: 10px; }

    /* Recommendation */
    .rec-section { padding: 20px; }
    .rec-box { padding: 22px; border-radius: 16px; }
    .rec-header h4 { font-size: 19px; }
    .rec-text { font-size: 15px; line-height: 1.7; }

    /* Deadline */
    .deadline-section { padding: 0 20px 20px; }
    .deadline-box { flex-direction: column; gap: 8px; text-align: center; padding: 16px 18px; border-radius: 14px; }
    .deadline-text { font-size: 15px; }

    /* Promo & footer */
    .pch-promo { border-radius: 18px; padding: 28px 22px; }
    .pch-promo h4 { font-size: 20px; margin-bottom: 10px; }
    .pch-promo p { font-size: 15px; line-height: 1.6; margin-bottom: 20px; }
    .pch-promo a { padding: 14px 32px; font-size: 16px; border-radius: 12px; }
    .start-over-btn { padding: 16px; font-size: 16px; border-radius: 14px; }
    .privacy { font-size: 13px; padding: 28px 20px 36px; }

    /* Loading & Error */
    .spinner { width: 56px; height: 56px; }
    .loading-overlay h3 { font-size: 22px; }
    .loading-overlay p { font-size: 15px; }
    .error-box { padding: 24px; border-radius: 16px; }
    .error-box p { font-size: 15px; }
    .error-box .err-icon { font-size: 36px; }
    .error-box button { padding: 12px 24px; font-size: 15px; border-radius: 10px; }
  }
</style>
</head>
<body>

<!-- ========== UPLOAD VIEW ========== -->
<div id="uploadView">
  <div class="container">
    <div class="header">
      <div class="logo-row">üêæ Pet Claim IQ</div>
      <h1>How much will pet insurance reimburse you for this bill?</h1>
      <p>Upload your vet bill and insurance documents. Our AI analyzes your coverage line by line and gives you a clear estimate of what you'll likely get back.</p>
      <div class="trust-bar">
        <div class="trust-item"><span class="ti-icon green">üîí</span> Files deleted after analysis</div>
        <div class="trust-item"><span class="ti-icon green">ü§ñ</span> AI-powered analysis</div>
        <div class="trust-item"><span class="ti-icon blue">‚ÑπÔ∏è</span> Your insurer makes the final decision</div>
      </div>
    </div>

    <div class="steps">
      <div class="step active"><span class="step-num">1</span> Share</div>
      <span class="step-arrow">‚Üí</span>
      <div class="step"><span class="step-num">2</span> Analyze</div>
      <span class="step-arrow">‚Üí</span>
      <div class="step"><span class="step-num">3</span> See Results</div>
    </div>

    <div class="upload-section">
      <div class="upload-inner">

        <div class="upload-group">
          <div class="upload-label">üìÑ Vet Bill <span class="req">Required</span></div>
          <div class="upload-hint">Your vet bill or invoice showing itemized charges</div>
          <div class="drop-zone" id="dropVetBill">
            <input type="file" accept=".pdf,.jpg,.jpeg,.png,.webp,.heic,.heif" id="vetBillInput">
            <div class="drop-default">
              <div class="drop-icon">üìé</div>
              <div class="drop-text"><strong>Tap to upload</strong> or drag file here</div>
            </div>
            <div class="file-name" style="display:none"></div>
          </div>
        </div>

        <div class="upload-group">
          <div class="upload-label">üõ°Ô∏è Insurance Documents <span class="opt">Optional but recommended</span></div>
          <div class="upload-hint">Upload your declarations page, policy summary, terms & conditions ‚Äî whatever your insurer sent you. We'll figure out what's what.</div>
          <div class="drop-zone" id="dropInsurance">
            <input type="file" accept=".pdf,.jpg,.jpeg,.png,.webp,.heic,.heif" id="insuranceInput" multiple>
            <div class="drop-default">
              <div class="drop-icon">üìé</div>
              <div class="drop-text"><strong>Tap to upload</strong> or drag files here</div>
            </div>
          </div>
          <div class="file-chips" id="insuranceChips"></div>
        </div>

        <div class="helper-box">
          <span class="hb-icon">üí°</span>
          <p>Not sure what to upload? Start with anything that shows your deductible and reimbursement %. If you're missing insurance documents, we can still read your vet bill and tell you which pages to add for a better estimate.</p>
        </div>

        <button class="analyze-btn" id="analyzeBtn" onclick="analyzeDocuments()">Estimate My Reimbursement</button>
      </div>
    </div>

    <p style="text-align:center; font-size:13px; color:var(--g500); margin-bottom:8px; line-height:1.5;">
      Results are AI-generated estimates to help you understand your coverage.<br>Your insurer makes the final reimbursement decision.
    </p>
  </div>
</div>

<!-- ========== LOADING VIEW ========== -->
<div id="loadingView" class="loading-overlay">
  <div class="container">
    <div class="spinner"></div>
    <h3>Analyzing your documents...</h3>
    <p>Reading your vet bill, checking policy exclusions, running the math.<br>This usually takes 30‚Äì60 seconds.</p>
  </div>
</div>

<!-- ========== ERROR VIEW ========== -->
<div id="errorView" class="error-box">
  <div class="container">
    <div class="err-icon">üòø</div>
    <p id="errorMsg">Something went wrong analyzing your documents. Please try again.</p>
    <button onclick="resetAll()">Try Again</button>
  </div>
</div>

<!-- ========== RESULTS VIEW ========== -->
<div id="resultsView" class="results-section">
  <div class="container">
    <div class="header" style="padding-top:30px; padding-bottom:0;">
      <div class="logo-row">üêæ Pet Claim IQ ‚Äî Your Results</div>
      <div class="results-disclaimer">‚ÑπÔ∏è Your insurer makes the final reimbursement decision</div>
    </div>

    <div class="result-card">
      <div class="result-header">
        <div class="result-top-row">
          <div class="result-pet">
            <h3 id="rPetName">Your Pet's Vet Visit</h3>
            <div class="pet-sub" id="rPetSub"></div>
          </div>
          <div style="display:flex; flex-direction:column; align-items:flex-end; gap:6px;">
            <div class="result-insurer" id="rInsurer"></div>
            <div id="rConfidence"></div>
          </div>
        </div>
        <div class="result-meta" id="rMeta"></div>
      </div>

      <div class="line-items">
        <div class="section-title" id="rLineTitle">Line-by-Line Coverage Analysis</div>
        <div id="rLineItems"></div>
      </div>

      <div id="rMissing" style="display:none;"></div>
      <div id="rBillOnly" style="display:none;"></div>
      <div id="rWarnings" style="display:none; padding:0 0 20px 0;"></div>

      <div class="math-section" id="rMathSection" style="display:none;">
        <div class="section-title">Reimbursement Estimate</div>
        <div class="math-box" id="rMath"></div>
      </div>

      <div class="deductible-section" id="rDedSection" style="display:none;">
        <div class="section-title">Calculate Your Actual Reimbursement</div>
        <p style="font-size:13px; color:var(--g600); margin-bottom:4px;">Enter how much of your annual deductible you've already used this policy year.</p>
        <div class="ded-input-row">
          <label for="dedInput">Deductible used so far: $</label>
          <input type="number" class="ded-input" id="dedInput" placeholder="0.00" min="0" step="0.01">
          <span class="ded-annual" id="dedAnnual"></span>
        </div>
        <div id="dedRemaining" style="font-size:14px; color:var(--g700); font-weight:500; margin:-4px 0 8px;"></div>
        <div class="ded-results" id="dedResults"></div>
      </div>

      <div class="deadline-section" id="rDeadline" style="display:none;"></div>

      <div class="rec-section" id="rRecSection" style="display:none;">
        <div id="rRec"></div>
      </div>
    </div>

    <div class="pch-promo">
      <h4>Want to actually file this claim?</h4>
      <p>Pet Claim Helper tracks your vet bills, files claims automatically, monitors deadlines, and shows you exactly what insurance owes you.</p>
      <a href="https://petclaimhelper.com" target="_blank">Try Pet Claim Helper Free ‚Üí</a>
    </div>

    <button class="start-over-btn" onclick="resetAll()">‚Üê Analyze Another Bill</button>
  </div>
</div>

<div class="privacy">
  <strong>üîí Your Privacy</strong><br>
  Your documents are analyzed in real-time and deleted after analysis is complete. We do not store, save, or retain any of your files or personal information.
</div>

<script>
const API_URL = 'https://pet-claim-helper.onrender.com/api/analyze-claim';
let vetBillFile = null;
let lastAnalysis = null;

// === VET BILL ===
const vetBillZone = document.getElementById('dropVetBill');
const vetBillInput = document.getElementById('vetBillInput');

vetBillInput.addEventListener('change', (e) => {
  if (e.target.files[0]) setVetBill(e.target.files[0]);
});
vetBillZone.addEventListener('dragover', (e) => { e.preventDefault(); vetBillZone.classList.add('dragover'); });
vetBillZone.addEventListener('dragleave', () => vetBillZone.classList.remove('dragover'));
vetBillZone.addEventListener('drop', (e) => {
  e.preventDefault(); vetBillZone.classList.remove('dragover');
  if (e.dataTransfer.files[0]) { setVetBill(e.dataTransfer.files[0]); vetBillInput.files = e.dataTransfer.files; }
});

function setVetBill(file) {
  vetBillFile = file;
  vetBillZone.classList.add('has-file');
  vetBillZone.querySelector('.drop-default').style.display = 'none';
  const nameEl = vetBillZone.querySelector('.file-name');
  nameEl.style.display = 'flex';
  nameEl.innerHTML = `‚úÖ ${trunc(file.name)} <button class="file-remove" onclick="removeVetBill(event)">&times;</button>`;
}

function removeVetBill(e) {
  e.stopPropagation();
  vetBillFile = null; vetBillInput.value = '';
  vetBillZone.classList.remove('has-file');
  vetBillZone.querySelector('.drop-default').style.display = '';
  vetBillZone.querySelector('.file-name').style.display = 'none';
}

// === INSURANCE DOCS ===
let insuranceFiles = [];
const insuranceZone = document.getElementById('dropInsurance');
const insuranceInput = document.getElementById('insuranceInput');
const chipsContainer = document.getElementById('insuranceChips');

insuranceInput.addEventListener('change', (e) => addInsuranceFiles(e.target.files));
insuranceZone.addEventListener('dragover', (e) => { e.preventDefault(); insuranceZone.classList.add('dragover'); });
insuranceZone.addEventListener('dragleave', () => insuranceZone.classList.remove('dragover'));
insuranceZone.addEventListener('drop', (e) => {
  e.preventDefault(); insuranceZone.classList.remove('dragover');
  addInsuranceFiles(e.dataTransfer.files);
});

function addInsuranceFiles(fileList) {
  for (let i = 0; i < fileList.length; i++) {
    if (insuranceFiles.length >= 5) break;
    insuranceFiles.push(fileList[i]);
  }
  renderInsuranceChips();
}

function removeInsuranceFile(idx) {
  insuranceFiles.splice(idx, 1);
  renderInsuranceChips();
}

function renderInsuranceChips() {
  if (insuranceFiles.length === 0) {
    chipsContainer.innerHTML = '';
    insuranceZone.classList.remove('has-file');
    insuranceZone.querySelector('.drop-default').style.display = '';
    return;
  }
  insuranceZone.classList.add('has-file');
  insuranceZone.querySelector('.drop-default').style.display = 'none';
  let html = insuranceFiles.map((f, i) =>
    `<div class="file-chip">‚úÖ ${trunc(f.name)} <button onclick="removeInsuranceFile(${i})">&times;</button></div>`
  ).join('');
  if (insuranceFiles.length < 5) {
    html += `<button class="add-more-btn" onclick="document.getElementById('insuranceInput').click()">+ Add more</button>`;
  }
  chipsContainer.innerHTML = html;
}

function trunc(name) { return name.length > 25 ? name.substring(0, 22) + '...' : name; }

// === ANALYZE ===
async function analyzeDocuments() {
  if (!vetBillFile) { alert('Please upload your vet bill.'); return; }

  document.getElementById('uploadView').style.display = 'none';
  document.getElementById('loadingView').classList.add('visible');
  document.getElementById('errorView').classList.remove('visible');
  document.getElementById('errorView').style.display = 'none';
  document.getElementById('resultsView').classList.remove('visible');
  window.scrollTo(0, 0);

  const formData = new FormData();
  formData.append('vetBill', vetBillFile);
  insuranceFiles.forEach(f => formData.append('insuranceDocs', f));

  try {
    const controller = new AbortController();
    const timeout = setTimeout(() => controller.abort(), 90000);
    const response = await fetch(API_URL, { method: 'POST', body: formData, signal: controller.signal });
    clearTimeout(timeout);

    if (!response.ok) {
      const err = await response.json().catch(() => ({}));
      if (response.status === 429) showError('Too many requests. Please wait a few minutes and try again.');
      else showError(err.error || 'Something went wrong analyzing your documents. Please try again.');
      return;
    }

    const result = await response.json();
    if (result.ok && result.data) {
      lastAnalysis = result.data;
      renderResults(result.data);
    } else {
      showError(result.error || 'Analysis failed. Please try again.');
    }
  } catch (err) {
    if (err.name === 'AbortError') showError('Analysis is taking longer than expected. Please try again in a moment.');
    else showError('Something went wrong. Please check your connection and try again.');
  }
}

function showError(msg) {
  document.getElementById('loadingView').classList.remove('visible');
  document.getElementById('errorView').classList.add('visible');
  document.getElementById('errorView').style.display = 'block';
  document.getElementById('errorMsg').textContent = msg;
  window.scrollTo(0, 0);
}

function resetAll() {
  vetBillFile = null; insuranceFiles = []; lastAnalysis = null;
  vetBillInput.value = ''; insuranceInput.value = '';
  vetBillZone.classList.remove('has-file');
  vetBillZone.querySelector('.drop-default').style.display = '';
  vetBillZone.querySelector('.file-name').style.display = 'none';
  chipsContainer.innerHTML = '';
  insuranceZone.classList.remove('has-file');
  insuranceZone.querySelector('.drop-default').style.display = '';
  document.getElementById('uploadView').style.display = '';
  document.getElementById('loadingView').classList.remove('visible');
  document.getElementById('errorView').classList.remove('visible');
  document.getElementById('errorView').style.display = 'none';
  document.getElementById('resultsView').classList.remove('visible');
  window.scrollTo(0, 0);
}

function goBackToUpload() {
  document.getElementById('uploadView').style.display = '';
  document.getElementById('resultsView').classList.remove('visible');
  window.scrollTo(0, 0);
}

// === RENDER RESULTS ===
function renderResults(data) {
  document.getElementById('loadingView').classList.remove('visible');
  document.getElementById('resultsView').classList.add('visible');
  window.scrollTo(0, 0);

  const { completeness, missingInfo, missingDocumentHint, petInfo, billInfo, policyInfo, analysis } = data;
  const isFull = completeness === 'full';
  const isPartial = completeness === 'partial';
  const isBillOnly = completeness === 'bill_only';

  // Pet name
  const petName = petInfo?.name || 'Your Pet';
  document.getElementById('rPetName').textContent = `üêæ ${petName}'s Vet Visit`;
  document.getElementById('rPetSub').textContent = [petInfo?.breed, petInfo?.species].filter(Boolean).join(' ¬∑ ') || '';

  // Insurer
  const insurerEl = document.getElementById('rInsurer');
  if (policyInfo?.insurer) { insurerEl.textContent = policyInfo.insurer; insurerEl.style.display = ''; }
  else { insurerEl.style.display = 'none'; }

  // Confidence badge
  const confEl = document.getElementById('rConfidence');
  const hasInsuranceDocs = insuranceFiles.length > 0;
  const hasDeductible = !!policyInfo?.annualDeductible;
  const hasRate = !!policyInfo?.reimbursementRate;

  let confLevel, confLabel;
  if (isFull && hasInsuranceDocs && hasDeductible && hasRate) {
    confLevel = 'high'; confLabel = 'High';
  } else if ((isFull || isPartial) && hasInsuranceDocs) {
    confLevel = 'medium'; confLabel = 'Medium';
  } else {
    confLevel = 'low'; confLabel = 'Low';
  }
  confEl.innerHTML = `<div class="confidence-badge ${confLevel}">Confidence: ${confLabel}</div>
    <div class="confidence-help">Based on document completeness and policy clarity</div>`;

  // Meta
  const metaHtml = [];
  if (billInfo?.clinic) metaHtml.push(`üè• ${billInfo.clinic}`);
  if (billInfo?.date) metaHtml.push(`üìÖ <strong>${billInfo.date}</strong>`);
  metaHtml.push(`üí∞ Total: <strong>$${fmt(analysis?.totalBill || billInfo?.total || 0)}</strong>`);
  document.getElementById('rMeta').innerHTML = metaHtml.map(m => `<span>${m}</span>`).join('');

  // Line items title
  document.getElementById('rLineTitle').textContent = isFull ? 'Line-by-Line Coverage Analysis' : 'Vet Bill Line Items';

  // Line items
  const liContainer = document.getElementById('rLineItems');
  liContainer.innerHTML = '';
  (billInfo?.lineItems || []).forEach(item => {
    // Skip "Invoice Complete" or zero-amount end-of-invoice markers
    if ((item.description || '').toLowerCase().includes('invoice complete') && (item.amount === 0 || !item.amount)) return;

    const isUnknown = item.covered === null;
    const isCovered = item.covered === true;
    const isUncertain = !isUnknown && (item.reason || '').toLowerCase().includes('uncertain');
    const isExcluded = item.covered === false && !isUncertain;

    let statusClass, statusIcon, reasonClass, amtClass;
    if (isUnknown) { statusClass = 'unknown'; statusIcon = '‚Äî'; reasonClass = ''; amtClass = ''; }
    else if (isCovered) { statusClass = 'covered'; statusIcon = '‚úì'; reasonClass = ''; amtClass = ''; }
    else if (isUncertain) { statusClass = 'uncertain'; statusIcon = '?'; reasonClass = 'unc'; amtClass = ''; }
    else { statusClass = 'excluded'; statusIcon = '‚úó'; reasonClass = 'exc'; amtClass = 'struck'; }

    // Parse reason vs source
    let reasonText = item.reason || '';
    let sourceText = '';
    const dashMatch = reasonText.match(/^(.+?)\s*[‚Äî‚Äì-]\s*(.+)$/);
    if (dashMatch && !isUnknown) {
      sourceText = dashMatch[1].trim();
      reasonText = dashMatch[2].trim();
    }

    liContainer.innerHTML += `
      <div class="line-item">
        <div class="li-left">
          <div class="li-status ${statusClass}">${statusIcon}</div>
          <div>
            <div class="li-name">${esc(item.description)}</div>
            ${reasonText && !isUnknown ? `<div class="li-reason ${reasonClass}">${esc(reasonText)}</div>` : ''}
            ${sourceText && !isUnknown ? `<div class="li-reason" style="color:var(--g500); font-size:11px;">Source: ${esc(sourceText)}</div>` : ''}
          </div>
        </div>
        <div class="li-amount ${amtClass}">$${fmt(item.amount)}</div>
      </div>`;
  });

  // Partial
  const missingEl = document.getElementById('rMissing');
  if (isPartial && missingInfo?.length) {
    missingEl.style.display = 'block';
    missingEl.innerHTML = `<div class="missing-box">
      <h4>‚ö†Ô∏è We need a bit more to give you accurate numbers</h4>
      <ul>${missingInfo.map(m => `<li>${esc(m)}</li>`).join('')}</ul>
      ${missingDocumentHint ? `<p class="hint">üí° ${esc(missingDocumentHint)}</p>` : ''}
      <button onclick="goBackToUpload()">Upload More Documents</button>
    </div>`;
  } else { missingEl.style.display = 'none'; }

  // Bill only
  const billOnlyEl = document.getElementById('rBillOnly');
  if (isBillOnly) {
    billOnlyEl.style.display = 'block';
    billOnlyEl.innerHTML = `<div class="bill-only-box">
      <h4>üìÑ Upload your insurance documents to see coverage analysis</h4>
      <p>We extracted your vet bill details above. To analyze what's covered and estimate your reimbursement, we need at least one insurance document.</p>
      <p>Look for emails from your insurance company with subject lines like "Your Policy Documents," "Declarations Page," or "Welcome to [Insurer Name]."</p>
      <button onclick="goBackToUpload()">Add Insurance Documents</button>
    </div>`;
  } else { billOnlyEl.style.display = 'none'; }

  // Warnings
  const warnBox = document.getElementById('rWarnings');
  if (isFull && analysis?.exclusionWarnings?.length) {
    warnBox.style.display = 'block';
    warnBox.innerHTML = `<div class="warnings-box">${analysis.exclusionWarnings.map(w => `<p>‚ö†Ô∏è <strong>${esc(w)}</strong></p>`).join('')}</div>`;
  } else { warnBox.style.display = 'none'; }

  // Math
  const mathSection = document.getElementById('rMathSection');
  if (isFull && analysis) {
    mathSection.style.display = '';
    const rate = policyInfo?.reimbursementRate || 80;
    const maxReimb = analysis.maxReimbursement || analysis.reimbursementBeforeDeductible || 0;
    document.getElementById('rMath').innerHTML = `
      <div class="math-row"><span class="math-label">Total bill</span><span class="math-val">$${fmt(analysis.totalBill)}</span></div>
      <div class="math-row"><span class="math-label">Excluded charges</span><span class="math-val">‚àí $${fmt(analysis.totalExcluded)}</span></div>
      <div class="math-row math-divider"><span class="math-label">Covered amount</span><span class="math-val">$${fmt(analysis.totalCovered)}</span></div>
      <div class="math-row"><span class="math-label">√ó ${rate}% reimbursement rate</span><span class="math-val">$${fmt(maxReimb)}</span></div>
      <div class="math-row math-result"><span class="math-label">Estimated reimbursement (if deductible met)</span><span class="math-val">$${fmt(maxReimb)}</span></div>
      <div class="math-note">This assumes your annual deductible is already fully met. Enter your deductible progress below for a more precise estimate.</div>`;
  } else { mathSection.style.display = 'none'; }

  // Deductible calculator
  const dedSection = document.getElementById('rDedSection');
  if (isFull && policyInfo?.annualDeductible) {
    dedSection.style.display = '';
    document.getElementById('dedAnnual').textContent = `Annual deductible: $${fmt(policyInfo.annualDeductible)}`;
    document.getElementById('dedInput').value = '';
    document.getElementById('dedResults').classList.remove('visible');
    document.getElementById('dedResults').innerHTML = '';
  } else { dedSection.style.display = 'none'; }

  // Deadline
  const dlSection = document.getElementById('rDeadline');
  if (isFull && policyInfo?.filingDeadline) {
    dlSection.style.display = 'block';
    dlSection.innerHTML = `<div class="section-title">Filing Deadline</div>
      <div class="deadline-box"><div class="deadline-left"><span>üìÖ</span>
      <div class="deadline-text">File by <strong>${esc(policyInfo.filingDeadline)}</strong></div></div></div>`;
  } else { dlSection.style.display = 'none'; }

  // Recommendation
  const recSection = document.getElementById('rRecSection');
  if (isFull && analysis) {
    recSection.style.display = '';
    const shouldFile = analysis.shouldFile !== false;
    const defaultReason = shouldFile
      ? 'Filing can help you reach your deductible faster, even if reimbursement is low right now. If your plan applies these covered charges toward your deductible, filing is usually worth it.'
      : 'Consider whether the covered amount justifies filing. Review your policy terms before deciding.';
    document.getElementById('rRec').innerHTML = `
      <div class="rec-box ${shouldFile ? '' : 'no-file'}">
        <div class="rec-header"><span>${shouldFile ? '‚úÖ' : '‚ö†Ô∏è'}</span>
        <h4>Should You File This Claim?</h4></div>
        <div class="rec-text"><strong>${shouldFile ? 'Usually, yes ‚Äî file it.' : 'Consider your options.'}</strong> ${esc(analysis.shouldFileReason || defaultReason)}</div>
      </div>`;
  } else { recSection.style.display = 'none'; }
}

// === DEDUCTIBLE CALCULATOR ===
document.getElementById('dedInput').addEventListener('input', function() {
  if (!lastAnalysis) return;
  const { policyInfo, analysis } = lastAnalysis;
  const dedUsed = parseFloat(this.value) || 0;
  const annualDed = policyInfo?.annualDeductible || 0;
  const totalCovered = analysis?.totalCovered || 0;
  const rate = (policyInfo?.reimbursementRate || 80) / 100;
  const calcMethod = policyInfo?.calculationMethod || 'deductible-first';

  if (dedUsed < 0 || isNaN(dedUsed)) return;

  const remaining = Math.max(0, annualDed - dedUsed);
  document.getElementById('dedRemaining').textContent = `Deductible remaining: $${fmt(remaining)}`;
  const appliedToDed = Math.min(remaining, totalCovered);
  const eligibleForReimb = Math.max(0, totalCovered - remaining);

  let estimatedReimb;
  if (calcMethod === 'reimbursement-first') {
    estimatedReimb = Math.max(0, (totalCovered * rate) - remaining);
  } else {
    estimatedReimb = eligibleForReimb * rate;
  }
  estimatedReimb = Math.round(estimatedReimb * 100) / 100;

  const newProgress = Math.min(annualDed, dedUsed + appliedToDed);
  const progressPct = Math.min(100, (newProgress / annualDed) * 100);

  const resultsEl = document.getElementById('dedResults');
  resultsEl.classList.add('visible');
  resultsEl.innerHTML = `
    <div class="section-title">Your Estimated Reimbursement</div>
    <div class="math-row"><span class="math-label">Remaining deductible</span><span class="math-val">$${fmt(remaining)}</span></div>
    <div class="math-row"><span class="math-label">Applied to deductible from this visit</span><span class="math-val">$${fmt(appliedToDed)}</span></div>
    <div class="math-row"><span class="math-label">Eligible for reimbursement</span><span class="math-val">$${fmt(eligibleForReimb)}</span></div>
    <div class="math-row math-result"><span class="math-label">Estimated reimbursement check</span>
      <span class="math-val" style="color: ${estimatedReimb > 0 ? 'var(--green)' : 'var(--orange)'}">$${fmt(estimatedReimb)}</span></div>
    ${estimatedReimb === 0 && appliedToDed > 0 ? `<div class="math-note" style="color: var(--green-dark); font-style: normal; font-weight: 500;">
      üí° Even though this visit won't result in a check, filing applies $${fmt(appliedToDed)} toward your deductible. That's progress toward future reimbursements!</div>` : ''}
    <div class="ded-progress-bar"><div class="ded-progress-fill" style="width: ${progressPct}%"></div></div>
    <div class="ded-progress-label"><span>$${fmt(newProgress)} used</span><span>$${fmt(annualDed)} deductible</span></div>
    ${progressPct >= 100 ? `<div class="math-note" style="color: var(--green-dark); font-style: normal; font-weight: 600;">
      üéâ Your deductible is fully met! Every future covered charge gets reimbursed at ${policyInfo?.reimbursementRate || 80}%.</div>`
    : `<div class="math-note">$${fmt(Math.max(0, annualDed - newProgress))} more until you start receiving reimbursement checks.</div>`}`;
});

function fmt(n) { return Number(n || 0).toFixed(2); }
function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
</script>
</body>
</html>
